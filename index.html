<!DOCTYPE html>
<html lang="de">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>2048 Mobile</title>
    <style>
      body {
        font-family: "Segoe UI", sans-serif;
        background: #faf8ef;
        display: flex;
        flex-direction: column;
        align-items: center;
        margin: 0;
        padding: 0;
      }

      h1 {
        margin-top: 20px;
        color: #776e65;
      }

      #game-container {
        background: #bbada0;
        border-radius: 10px;
        padding: 10px;
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 10px;
        width: 90vw;
        max-width: 400px;
        height: 90vw;
        max-height: 400px;
        touch-action: none;
      }

      .tile {
        background: #cdc1b4;
        border-radius: 5px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 2em;
        font-weight: bold;
        color: #776e65;
        transition: all 0.15s ease-in-out;
      }

      .tile[data-value="2"] {
        background: #eee4da;
      }
      .tile[data-value="4"] {
        background: #ede0c8;
      }
      .tile[data-value="8"] {
        background: #f2b179;
        color: #f9f6f2;
      }
      .tile[data-value="16"] {
        background: #f59563;
        color: #f9f6f2;
      }
      .tile[data-value="32"] {
        background: #f67c5f;
        color: #f9f6f2;
      }
      .tile[data-value="64"] {
        background: #f65e3b;
        color: #f9f6f2;
      }
      .tile[data-value="128"] {
        background: #edcf72;
        color: #f9f6f2;
      }
      .tile[data-value="256"] {
        background: #edcc61;
        color: #f9f6f2;
      }
      .tile[data-value="512"] {
        background: #edc850;
        color: #f9f6f2;
      }
      .tile[data-value="1024"] {
        background: #edc53f;
        color: #f9f6f2;
      }
      .tile[data-value="2048"] {
        background: #edc22e;
        color: #f9f6f2;
      }

      #score {
        margin: 10px;
        font-size: 1.2em;
        color: #776e65;
      }
    </style>
  </head>
  <body>
    <h1>2048 Mobile</h1>
    <div id="score">Punkte: 0</div>
    <div id="game-container"></div>

    <script>
      const size = 4;
      let board = [];
      let score = 0;

      const container = document.getElementById("game-container");
      const scoreDisplay = document.getElementById("score");

      function initBoard() {
        board = Array(size)
          .fill()
          .map(() => Array(size).fill(0));
        addRandomTile();
        addRandomTile();
        drawBoard();
      }

      function addRandomTile() {
        let empty = [];
        for (let r = 0; r < size; r++) {
          for (let c = 0; c < size; c++) {
            if (board[r][c] === 0) empty.push({ r, c });
          }
        }
        if (empty.length > 0) {
          let { r, c } = empty[Math.floor(Math.random() * empty.length)];
          board[r][c] = Math.random() < 0.9 ? 2 : 4;
        }
      }

      function drawBoard() {
        container.innerHTML = "";
        for (let r = 0; r < size; r++) {
          for (let c = 0; c < size; c++) {
            const tile = document.createElement("div");
            tile.classList.add("tile");
            if (board[r][c] !== 0) {
              tile.textContent = board[r][c];
              tile.dataset.value = board[r][c];
            }
            container.appendChild(tile);
          }
        }
        scoreDisplay.textContent = "Punkte: " + score;
      }

      function slide(row) {
        row = row.filter((v) => v);
        for (let i = 0; i < row.length - 1; i++) {
          if (row[i] === row[i + 1]) {
            row[i] *= 2;
            score += row[i];
            row[i + 1] = 0;
          }
        }
        row = row.filter((v) => v);
        while (row.length < size) row.push(0);
        return row;
      }

      function moveLeft() {
        let moved = false;
        for (let r = 0; r < size; r++) {
          let newRow = slide(board[r]);
          if (board[r].toString() !== newRow.toString()) moved = true;
          board[r] = newRow;
        }
        if (moved) {
          addRandomTile();
          drawBoard();
        }
      }

      function moveRight() {
        let moved = false;
        for (let r = 0; r < size; r++) {
          let newRow = slide(board[r].slice().reverse()).reverse();
          if (board[r].toString() !== newRow.toString()) moved = true;
          board[r] = newRow;
        }
        if (moved) {
          addRandomTile();
          drawBoard();
        }
      }

      function moveUp() {
        let moved = false;
        for (let c = 0; c < size; c++) {
          let col = board.map((row) => row[c]);
          let newCol = slide(col);
          if (col.toString() !== newCol.toString()) moved = true;
          for (let r = 0; r < size; r++) board[r][c] = newCol[r];
        }
        if (moved) {
          addRandomTile();
          drawBoard();
        }
      }

      function moveDown() {
        let moved = false;
        for (let c = 0; c < size; c++) {
          let col = board.map((row) => row[c]).reverse();
          let newCol = slide(col).reverse();
          if (col.reverse().toString() !== newCol.toString()) moved = true;
          for (let r = 0; r < size; r++) board[r][c] = newCol[r];
        }
        if (moved) {
          addRandomTile();
          drawBoard();
        }
      }

      // Keyboard Steuerung
      document.addEventListener("keydown", (e) => {
        if (e.key === "ArrowLeft") moveLeft();
        if (e.key === "ArrowRight") moveRight();
        if (e.key === "ArrowUp") moveUp();
        if (e.key === "ArrowDown") moveDown();
      });

      // Touch Steuerung
      let startX, startY;
      container.addEventListener("touchstart", (e) => {
        startX = e.touches[0].clientX;
        startY = e.touches[0].clientY;
      });

      container.addEventListener("touchend", (e) => {
        let dx = e.changedTouches[0].clientX - startX;
        let dy = e.changedTouches[0].clientY - startY;
        if (Math.abs(dx) > Math.abs(dy)) {
          if (dx > 0) moveRight();
          else moveLeft();
        } else {
          if (dy > 0) moveDown();
          else moveUp();
        }
      });

      initBoard();
    </script>
  </body>
</html>
